<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 440">
  <defs>
    <linearGradient id="pds-blueGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0ea5e9"/>
      <stop offset="100%" style="stop-color:#38bdf8"/>
    </linearGradient>
    <linearGradient id="pds-primaryGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#6366f1"/>
      <stop offset="100%" style="stop-color:#8b5cf6"/>
    </linearGradient>
    <linearGradient id="pds-greenGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981"/>
      <stop offset="100%" style="stop-color:#34d399"/>
    </linearGradient>
    <linearGradient id="pds-amberGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f59e0b"/>
      <stop offset="100%" style="stop-color:#fbbf24"/>
    </linearGradient>
    <linearGradient id="pds-bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0f172a"/>
      <stop offset="100%" style="stop-color:#1e293b"/>
    </linearGradient>
    <filter id="pds-softGlow">
      <feGaussianBlur stdDeviation="6" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <pattern id="pds-grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#334155" stroke-width="0.5" opacity="0.3"/>
    </pattern>
  </defs>

  <style>
    .pds-label { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-weight: 600; }
    .pds-sublabel { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-weight: 500; }
    .pds-msg { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 9px; font-weight: 500; }
    .pds-note { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-size: 8px; fill: #94a3b8; }
    @keyframes pds-pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .pds-pulse { animation: pds-pulse 1.5s ease-in-out infinite; }
  </style>

  <!-- Background -->
  <rect width="750" height="440" rx="16" fill="url(#pds-bgGrad)"/>
  <rect width="750" height="440" fill="url(#pds-grid)" rx="16"/>

  <!-- Title -->
  <text x="375" y="28" text-anchor="middle" class="pds-label" font-size="14" fill="#e2e8f0">SGLang PD — Parallel Dispatch</text>

  <!-- Participant boxes -->
  <rect x="60" y="42" width="80" height="28" rx="8" fill="url(#pds-blueGrad)"/>
  <text x="100" y="61" text-anchor="middle" class="pds-label" font-size="10" fill="white">Client</text>

  <rect x="240" y="42" width="80" height="28" rx="8" fill="url(#pds-primaryGrad)"/>
  <text x="280" y="61" text-anchor="middle" class="pds-label" font-size="10" fill="white">SMG</text>

  <rect x="430" y="42" width="110" height="28" rx="8" fill="url(#pds-greenGrad)"/>
  <text x="485" y="61" text-anchor="middle" class="pds-label" font-size="10" fill="white">Prefill Worker</text>

  <rect x="610" y="42" width="110" height="28" rx="8" fill="url(#pds-amberGrad)"/>
  <text x="665" y="61" text-anchor="middle" class="pds-label" font-size="10" fill="#1e293b">Decode Worker</text>

  <!-- Lifelines -->
  <line x1="100" y1="70" x2="100" y2="415" stroke="#38bdf8" stroke-width="1.5" stroke-dasharray="4,4" opacity="0.4"/>
  <line x1="280" y1="70" x2="280" y2="415" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="4,4" opacity="0.4"/>
  <line x1="485" y1="70" x2="485" y2="415" stroke="#34d399" stroke-width="1.5" stroke-dasharray="4,4" opacity="0.4"/>
  <line x1="665" y1="70" x2="665" y2="415" stroke="#fbbf24" stroke-width="1.5" stroke-dasharray="4,4" opacity="0.4"/>

  <!-- Message 1: Client → SMG -->
  <line x1="100" y1="95" x2="275" y2="95" stroke="#38bdf8" stroke-width="1.5"/>
  <polygon points="272,91 280,95 272,99" fill="#38bdf8"/>
  <text x="188" y="89" text-anchor="middle" class="pds-msg" fill="#38bdf8">Chat completion request</text>

  <!-- Self: SMG → SMG (Find P/D pair) -->
  <rect x="283" y="108" width="90" height="20" rx="4" fill="#1e293b" stroke="#8b5cf6" stroke-width="1"/>
  <text x="328" y="122" text-anchor="middle" class="pds-note" fill="#a78bfa">Find P/D pair</text>

  <!-- Parallel dispatch container -->
  <rect x="230" y="135" width="480" height="55" rx="6" fill="none" stroke="#8b5cf6" stroke-width="1.5" stroke-dasharray="6,3"/>
  <rect x="234" y="135" width="105" height="16" rx="4" fill="#8b5cf6" opacity="0.3"/>
  <text x="286" y="147" text-anchor="middle" class="pds-note" fill="#a78bfa" font-weight="600">par Parallel Dispatch</text>

  <!-- SMG → Prefill (with bootstrap) -->
  <line x1="280" y1="160" x2="480" y2="160" stroke="#34d399" stroke-width="1.5"/>
  <polygon points="477,156 485,160 477,164" fill="#34d399"/>
  <text x="380" y="154" text-anchor="middle" class="pds-msg" fill="#34d399">Forward + bootstrap metadata</text>

  <!-- SMG → Decode (with bootstrap) -->
  <line x1="280" y1="178" x2="660" y2="178" stroke="#fbbf24" stroke-width="1.5"/>
  <polygon points="657,174 665,178 657,182" fill="#fbbf24"/>
  <text x="470" y="174" text-anchor="middle" class="pds-msg" fill="#fbbf24">Forward + bootstrap metadata</text>

  <!-- Self: Prefill processes prompt -->
  <rect x="488" y="198" width="100" height="20" rx="4" fill="#1e293b" stroke="#34d399" stroke-width="1"/>
  <text x="538" y="212" text-anchor="middle" class="pds-note" fill="#34d399">Process prompt</text>

  <!-- Prefill → Decode: Transfer KV cache -->
  <line x1="485" y1="230" x2="660" y2="230" stroke="#14b8a6" stroke-width="2"/>
  <polygon points="657,226 665,230 657,234" fill="#14b8a6"/>
  <text x="575" y="224" text-anchor="middle" class="pds-msg" fill="#2dd4bf">Transfer KV cache (bootstrap)</text>

  <!-- Prefill → SMG: Complete -->
  <line x1="485" y1="250" x2="285" y2="250" stroke="#34d399" stroke-width="1.5" stroke-dasharray="5,3"/>
  <polygon points="288,246 280,250 288,254" fill="#34d399"/>
  <text x="385" y="246" text-anchor="middle" class="pds-msg" fill="#34d399">Prefill complete</text>

  <!-- Token streaming loop -->
  <rect x="230" y="268" width="480" height="90" rx="6" fill="none" stroke="#f59e0b" stroke-width="1.5" stroke-dasharray="6,3"/>
  <rect x="234" y="268" width="115" height="16" rx="4" fill="#f59e0b" opacity="0.2"/>
  <text x="291" y="280" text-anchor="middle" class="pds-note" fill="#fbbf24" font-weight="600">loop Token Generation</text>

  <!-- Decode self: Generate token -->
  <rect x="668" y="290" width="65" height="16" rx="4" fill="#1e293b" stroke="#fbbf24" stroke-width="1" class="pds-pulse"/>
  <text x="700" y="302" text-anchor="middle" class="pds-note" fill="#fbbf24">Generate</text>

  <!-- Decode → SMG: Stream token -->
  <line x1="665" y1="315" x2="285" y2="315" stroke="#fbbf24" stroke-width="1.5" stroke-dasharray="5,3"/>
  <polygon points="288,311 280,315 288,319" fill="#fbbf24"/>
  <text x="475" y="311" text-anchor="middle" class="pds-msg" fill="#fbbf24">Stream token</text>

  <!-- SMG → Client: Stream token -->
  <line x1="280" y1="340" x2="105" y2="340" stroke="#a78bfa" stroke-width="1.5" stroke-dasharray="5,3"/>
  <polygon points="108,336 100,340 108,344" fill="#a78bfa"/>
  <text x="192" y="336" text-anchor="middle" class="pds-msg" fill="#a78bfa">Stream token</text>

  <!-- Final: Decode → SMG: Generation complete -->
  <line x1="665" y1="375" x2="285" y2="375" stroke="#fbbf24" stroke-width="1.5" stroke-dasharray="5,3"/>
  <polygon points="288,371 280,375 288,379" fill="#fbbf24"/>
  <text x="475" y="371" text-anchor="middle" class="pds-msg" fill="#fbbf24">Generation complete</text>

  <!-- Final: SMG → Client: Final response -->
  <line x1="280" y1="395" x2="105" y2="395" stroke="#a78bfa" stroke-width="1.5" stroke-dasharray="5,3"/>
  <polygon points="108,391 100,395 108,399" fill="#a78bfa"/>
  <text x="192" y="391" text-anchor="middle" class="pds-msg" fill="#a78bfa">Final response</text>

  <!-- Bottom tagline -->
  <text x="375" y="430" text-anchor="middle" class="pds-sublabel" font-size="11" fill="#64748b">Bootstrap Coordination  •  Parallel Workers  •  KV Cache Transfer</text>
</svg>
